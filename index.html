<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Gabungan Operasi Ungkapan Algebra</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #2d3748;
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 800;
            line-height: 1.2;
        }

        .header p {
            color: #718096;
            font-size: 1.3rem;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .language-toggle {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 25px;
        }

        .lang-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .lang-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .lang-btn.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .english {
            opacity: 0.7;
            font-size: 0.9em;
        }

        .hidden {
            display: none;
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f7fafc;
            padding: 10px 20px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
        }

        .block {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 14px;
        }

        .x-block { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .y-block { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .number-block { 
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #2d3748;
            width: 20px; 
            height: 20px; 
            border-radius: 50%;
        }
        .constant-block { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); color: #2d3748; }

        .question-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0 35px 0;
            flex-wrap: wrap;
        }

        .question-btn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
            min-width: 200px;
        }

        .question-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
        }

        .question-btn.active {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .simulation-area {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0f8ff 50%, #fff5f5 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            min-height: 400px;
            border: 2px solid #e2e8f0;
        }

        .step {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid #4299e1;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .step.active {
            opacity: 1;
            transform: translateY(0);
        }

        .step-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .step-number {
            background: #4299e1;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .expression {
            font-size: 1.8rem;
            text-align: center;
            margin: 25px 0;
            padding: 25px;
            background: #f0f8ff;
            border-radius: 20px;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            font-weight: 600;
            line-height: 1.8;
            border: 3px solid #4ecdc4;
        }

        .math-fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 8px;
            vertical-align: middle;
        }

        .math-numerator, .math-denominator {
            padding: 4px 8px;
            font-size: 1.1rem;
        }

        .math-fraction-line {
            width: 100%;
            height: 2px;
            background: #2d3748;
            margin: 2px 0;
            min-width: 60px;
        }

        .math-operator {
            font-size: 1.8rem;
            margin: 0 12px;
            color: #e53e3e;
            font-weight: 600;
        }

        .visual-blocks {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .fraction-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 10px;
        }

        .numerator, .denominator {
            display: flex;
            gap: 5px;
            align-items: center;
            padding: 10px;
            min-height: 40px;
            justify-content: center;
        }

        .fraction-line {
            width: 100%;
            height: 3px;
            background: #2d3748;
            margin: 5px 0;
        }

        .operator {
            font-size: 2rem;
            font-weight: bold;
            color: #e53e3e;
            margin: 0 15px;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            box-shadow: 0 3px 12px rgba(108, 92, 231, 0.3);
            min-width: 120px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 92, 231, 0.4);
        }

        .control-btn:disabled {
            background: linear-gradient(135deg, #bdbdbd 0%, #e0e0e0 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 8px rgba(189, 189, 189, 0.2);
        }

        .practice-btn {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%) !important;
            box-shadow: 0 3px 12px rgba(255, 154, 158, 0.3) !important;
        }

        .practice-btn:hover {
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4) !important;
        }

        .explanation {
            background: #e6fffa;
            border: 2px solid #81e6d9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #234e52;
        }

        .tips-section {
            background: linear-gradient(135deg, #fff9e6 0%, #f0f8ff 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #ffd700;
        }

        .tips-header {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }

        .tips-content {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            flex-wrap: wrap;
        }

        .tip-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 12px 16px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 0.9rem;
            font-weight: 500;
            color: #2d3748;
            flex: 1;
            min-width: 200px;
            justify-content: flex-start;
        }

        .tip-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
            width: 24px;
            text-align: center;
        }

        .highlight {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            padding: 3px 8px;
            border-radius: 6px;
            animation: glow 2s infinite;
            font-weight: 600;
            color: #2d3748;
            border: 2px solid #f6ad55;
        }

        .highlight-red {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            animation: pulse 1.5s infinite;
            font-weight: 600;
        }

        .highlight-green {
            background: linear-gradient(135deg, #48bb78 0%, #68d391 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            animation: bounce 2s infinite;
            font-weight: 600;
        }

        .highlight-blue {
            background: linear-gradient(135deg, #4299e1 0%, #63b3ed 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 6px;
            animation: shake 2s infinite;
            font-weight: 600;
        }

        @keyframes glow {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
                transform: scale(1.05);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.03); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .visual-step {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .visual-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .arrow {
            font-size: 2rem;
            color: #4299e1;
            margin: 10px 20px;
            animation: moveRight 2s infinite;
        }

        @keyframes moveRight {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(10px); }
        }

        .factor-box {
            display: inline-block;
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border: 2px solid #4fd1c7;
            border-radius: 10px;
            padding: 8px 12px;
            margin: 5px;
            font-weight: 600;
            color: #234e52;
        }

        .cancel-line {
            position: relative;
            display: inline-block;
        }

        .cancel-line::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: #e53e3e;
            transform: rotate(-15deg);
            animation: drawLine 1s ease-in-out;
        }

        @keyframes drawLine {
            from { width: 0; }
            to { width: 100%; }
        }

        .step-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .fraction-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #cbd5e0;
            min-width: 120px;
        }

        .numerator-display, .denominator-display {
            padding: 8px 12px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fraction-line-display {
            width: 100%;
            height: 3px;
            background: #2d3748;
            margin: 8px 0;
        }

        .operation-symbol {
            font-size: 2.5rem;
            font-weight: bold;
            color: #e53e3e;
            margin: 0 15px;
            animation: pulse 2s infinite;
        }

        .explanation-box {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border: 2px solid #fc8181;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
        }

        .explanation-box::before {
            content: '💡';
            position: absolute;
            top: -10px;
            left: 15px;
            background: white;
            padding: 5px;
            border-radius: 50%;
            font-size: 1.2rem;
        }

        .key-point {
            background: linear-gradient(135deg, #e6fffa 0%, #b2f5ea 100%);
            border-left: 4px solid #38b2ac;
            padding: 12px 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
            font-weight: 500;
        }

        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .legend {
                gap: 15px;
            }
            
            .question-selector {
                flex-direction: column;
                align-items: center;
            }
            
            .expression {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧮 <span class="malay">Gabungan Operasi Ungkapan Algebra</span> <span class="english">/ Algebraic Expression Operations</span></h1>
            <p><span class="malay">Matematik Tingkatan 2, Bab 2</span> <span class="english">/ Form 2 Mathematics, Chapter 2</span></p>
            <div class="language-toggle">
                <button class="lang-btn active" onclick="toggleLanguage('ms')">Bahasa Malaysia</button>
                <button class="lang-btn" onclick="toggleLanguage('en')">English</button>
            </div>
        </div>

        <div class="question-selector">
            <button class="question-btn active" onclick="selectQuestion(1)">
                <span class="malay">Soalan (i): Penambahan Pecahan</span>
                <span class="english hidden">Question (i): Addition of Fractions</span>
            </button>
            <button class="question-btn" onclick="selectQuestion(2)">
                <span class="malay">Soalan (ii): Pembahagian Pecahan</span>
                <span class="english hidden">Question (ii): Division of Fractions</span>
            </button>
        </div>



        <div class="controls">
            <button class="control-btn" id="prevBtn" onclick="previousStep()" disabled>
                ⬅️ <span class="malay">Sebelum</span><span class="english hidden">Previous</span>
            </button>
            <button class="control-btn" id="nextBtn" onclick="nextStep()">
                <span class="malay">Seterusnya</span><span class="english hidden">Next</span> ➡️
            </button>
            <button class="control-btn" id="autoPlayBtn" onclick="toggleAutoPlay()">
                ▶️ <span class="malay">Auto</span><span class="english hidden">Auto</span>
            </button>
            <button class="control-btn" onclick="resetSimulation()">
                🔄 <span class="malay">Reset</span><span class="english hidden">Reset</span>
            </button>
            <button class="control-btn practice-btn" onclick="showPractice()">
                📝 <span class="malay">Latihan</span><span class="english hidden">Practice</span>
            </button>
        </div>

        <div class="simulation-area" id="simulationArea">
            <!-- Kandungan simulasi akan dipaparkan di sini -->
        </div>

        <div class="tips-section">
            <div class="tips-header">
                💡 <span class="malay">Tips Berguna</span><span class="english hidden">Useful Tips</span>
            </div>
            <div class="tips-content">
                <div class="tip-item">
                    <span class="tip-icon">🔍</span>
                    <span class="malay">Sentiasa faktorkan terlebih dahulu sebelum operasi</span>
                    <span class="english hidden">Always factorize first before operations</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">⚖️</span>
                    <span class="malay">Cari penyebut sepunya untuk penambahan/penolakan</span>
                    <span class="english hidden">Find common denominator for addition/subtraction</span>
                </div>
                <div class="tip-item">
                    <span class="tip-icon">🔄</span>
                    <span class="malay">Pembahagian = pendaraban dengan songsang</span>
                    <span class="english hidden">Division = multiplication by reciprocal</span>
                </div>
            </div>
        </div>

    </div>

    <script>
        let currentQuestion = 1;
        let currentStep = 0;
        let maxSteps = 0;
        let currentLanguage = 'ms';
        let autoPlayInterval = null;
        let isAutoPlaying = false;

        const questions = {
            1: {
                title: {
                    ms: "Penambahan Pecahan Algebra",
                    en: "Addition of Algebraic Fractions"
                },
                mathExpression: `<div class="math-fraction"><div class="math-numerator">xy - 2y</div><div class="math-fraction-line"></div><div class="math-denominator">3x - 6</div></div><span class="math-operator">+</span><div class="math-fraction"><div class="math-numerator">x² - y²</div><div class="math-fraction-line"></div><div class="math-denominator">5xy + 5y²</div></div>`,
                steps: [
                    {
                        title: {
                            ms: "Soalan Asal",
                            en: "Original Question"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">xy - 2y</div><div class="math-fraction-line"></div><div class="math-denominator">3x - 6</div></div><span class="math-operator">+</span><div class="math-fraction"><div class="math-numerator">x² - y²</div><div class="math-fraction-line"></div><div class="math-denominator">5xy + 5y²</div></div>`,
                        visual: "original1",
                        explanation: {
                            ms: "Kita perlu menyelesaikan penambahan dua pecahan algebra ini langkah demi langkah.",
                            en: "We need to solve this addition of two algebraic fractions step by step."
                        }
                    },
                    {
                        title: {
                            ms: "Langkah 1: Faktorkan Pengangka dan Penyebut",
                            en: "Step 1: Factorize Numerator and Denominator"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">y(x - 2)</div><div class="math-fraction-line"></div><div class="math-denominator">3(x - 2)</div></div><span class="math-operator">+</span><div class="math-fraction"><div class="math-numerator">(x - y)(x + y)</div><div class="math-fraction-line"></div><div class="math-denominator">5y(x + y)</div></div>`,
                        visual: "factor1",
                        explanation: {
                            ms: "Faktorkan setiap bahagian: xy - 2y = y(x - 2), 3x - 6 = 3(x - 2), x² - y² = (x - y)(x + y), 5xy + 5y² = 5y(x + y)",
                            en: "Factor each part: xy - 2y = y(x - 2), 3x - 6 = 3(x - 2), x² - y² = (x - y)(x + y), 5xy + 5y² = 5y(x + y)"
                        }
                    },
                    {
                        title: {
                            ms: "Langkah 2: Permudahkan Pecahan",
                            en: "Step 2: Simplify Fractions"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">y</div><div class="math-fraction-line"></div><div class="math-denominator">3</div></div><span class="math-operator">+</span><div class="math-fraction"><div class="math-numerator">x - y</div><div class="math-fraction-line"></div><div class="math-denominator">5y</div></div>`,
                        visual: "simplify1",
                        explanation: {
                            ms: "Batalkan faktor sama: (x - 2) dalam pecahan pertama, (x + y) dalam pecahan kedua",
                            en: "Cancel common factors: (x - 2) in first fraction, (x + y) in second fraction"
                        }
                    },
                    {
                        title: {
                            ms: "Langkah 3: Cari Penyebut Sepunya Terkecil (PST)",
                            en: "Step 3: Find Lowest Common Multiple (LCM)"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">5y²</div><div class="math-fraction-line"></div><div class="math-denominator">15y</div></div><span class="math-operator">+</span><div class="math-fraction"><div class="math-numerator">3(x - y)</div><div class="math-fraction-line"></div><div class="math-denominator">15y</div></div>`,
                        visual: "lcm1",
                        explanation: {
                            ms: "PST untuk 3 dan 5y adalah 15y. Darabkan pengangka dan penyebut dengan faktor yang sesuai.",
                            en: "LCM of 3 and 5y is 15y. Multiply numerator and denominator by appropriate factors."
                        }
                    },
                    {
                        title: {
                            ms: "Langkah 4: Tambahkan Pecahan",
                            en: "Step 4: Add Fractions"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">5y² + 3x - 3y</div><div class="math-fraction-line"></div><div class="math-denominator">15y</div></div>`,
                        visual: "add1",
                        explanation: {
                            ms: "Gabungkan pengangka: 5y² + 3(x - y) = 5y² + 3x - 3y",
                            en: "Combine numerators: 5y² + 3(x - y) = 5y² + 3x - 3y"
                        }
                    },
                    {
                        title: {
                            ms: "Jawapan Akhir",
                            en: "Final Answer"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">3x + 5y² - 3y</div><div class="math-fraction-line"></div><div class="math-denominator">15y</div></div>`,
                        visual: "final1",
                        explanation: {
                            ms: "Susun semula sebutan dalam pengangka untuk mendapat jawapan akhir yang kemas.",
                            en: "Rearrange terms in numerator to get the neat final answer."
                        }
                    }
                ]
            },
            2: {
                title: {
                    ms: "Pembahagian Pecahan Algebra",
                    en: "Division of Algebraic Fractions"
                },
                mathExpression: `<div class="math-fraction"><div class="math-numerator">4a² - b²</div><div class="math-fraction-line"></div><div class="math-denominator">c - d</div></div><span class="math-operator">÷</span><div class="math-fraction"><div class="math-numerator">6a - 3b</div><div class="math-fraction-line"></div><div class="math-denominator">2c - 2d</div></div>`,
                steps: [
                    {
                        title: {
                            ms: "Soalan Asal",
                            en: "Original Question"
                        },
                        expression: `<div class="math-fraction"><div class="math-numerator">4a² - b²</div><div class="math-fraction-line"></div><div class="math-denominator">c - d</div></div><span class="math-operator">÷</span><div class="math-fraction"><div class="math-numerator">6a - 3b</div><div class="math-fraction-line"></div><div class="math-denominator">2c - 2d</div></div>`,
                        visual: "original2",
                        explanation: {
                            ms: "Kita perlu menyelesaikan pembahagian dua pecahan algebra ini.",
                            en: "We need to solve this division of two algebraic fractions."
                        }
                    },
                    {
                        title: "Langkah 1: Tukar Pembahagian kepada Pendaraban",
                        expression: "((4a² - b²)/(c - d)) × ((2c - 2d)/(6a - 3b))",
                        visual: "division2",
                        explanation: "Pembahagian pecahan = pendaraban dengan songsang pecahan kedua"
                    },
                    {
                        title: "Langkah 2: Faktorkan Semua Sebutan",
                        expression: "((2a - b)(2a + b)/(c - d)) × (2(c - d)/(3(2a - b)))",
                        visual: "factor2",
                        explanation: "4a² - b² = (2a - b)(2a + b), 6a - 3b = 3(2a - b), 2c - 2d = 2(c - d)"
                    },
                    {
                        title: "Langkah 3: Susun Semula untuk Mudah Dibatalkan",
                        expression: "((2a - b)(2a + b) × 2(c - d))/((c - d) × 3(2a - b))",
                        visual: "rearrange2",
                        explanation: "Susun dalam bentuk pecahan tunggal untuk mudah melihat faktor yang boleh dibatalkan"
                    },
                    {
                        title: "Langkah 4: Batalkan Faktor Sama",
                        expression: "(2a + b) × 2 / 3 = 2(2a + b)/3",
                        visual: "cancel2",
                        explanation: "Batalkan (2a - b) dan (c - d) yang muncul dalam pengangka dan penyebut"
                    },
                    {
                        title: "Jawapan Akhir",
                        expression: "(4a + 2b)/3",
                        visual: "final2",
                        explanation: "Kembangkan 2(2a + b) = 4a + 2b untuk mendapat jawapan akhir"
                    }
                ]
            }
        };

        function selectQuestion(questionNum) {
            currentQuestion = questionNum;
            currentStep = 0;
            
            // Update button states
            document.querySelectorAll('.question-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            maxSteps = questions[questionNum].steps.length - 1;
            updateSimulation();
            updateControls();
        }

        function updateSimulation() {
            const question = questions[currentQuestion];
            const step = question.steps[currentStep];
            
            const simulationArea = document.getElementById('simulationArea');
            
            simulationArea.innerHTML = `
                <div class="step active fade-in">
                    <div class="step-title">
                        <div class="step-number">${currentStep + 1}</div>
                        ${typeof step.title === 'object' ? step.title[currentLanguage] : step.title}
                    </div>
                    <div class="expression">${step.expression}</div>
                    
                    ${generateStepVisualization(currentQuestion, currentStep)}

                    <div class="explanation-box">
                        <strong><span class="malay">Penjelasan:</span><span class="english hidden">Explanation:</span></strong> ${typeof step.explanation === 'object' ? step.explanation[currentLanguage] : step.explanation}
                    </div>
                </div>
            `;
        }

        function generateStepVisualization(questionNum, stepNum) {
            const visualizations = {
                1: { // Question 1 visualizations
                    0: `
                        <div class="visual-step">
                            <div class="visual-title">🎯 <span class="malay">Lihat Soalan Asal</span><span class="english hidden">Look at Original Question</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight">xy - 2y</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-blue">3x - 6</span></div>
                                </div>
                                <div class="operation-symbol">+</div>
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight-green">x² - y²</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-red">5xy + 5y²</span></div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">🔍 Perhatikan: Setiap bahagian mempunyai warna berbeza untuk mudah diikuti</span>
                                <span class="english hidden">🔍 Notice: Each part has different colors for easy tracking</span>
                            </div>
                        </div>
                    `,
                    1: `
                        <div class="visual-step">
                            <div class="visual-title">🔧 <span class="malay">Faktorkan Setiap Bahagian</span><span class="english hidden">Factor Each Part</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="highlight">xy - 2y</span> <div class="arrow">→</div> <span class="factor-box">y(x - 2)</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="highlight-blue">3x - 6</span> <div class="arrow">→</div> <span class="factor-box">3(x - 2)</span>
                                    </div>
                                </div>
                                <div class="operation-symbol">+</div>
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="highlight-green">x² - y²</span> <div class="arrow">→</div> <span class="factor-box">(x-y)(x+y)</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="highlight-red">5xy + 5y²</span> <div class="arrow">→</div> <span class="factor-box">5y(x+y)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">✨ Faktor sepunya: Cari faktor yang sama dalam pengangka dan penyebut</span>
                                <span class="english hidden">✨ Common factors: Find same factors in numerator and denominator</span>
                            </div>
                        </div>
                    `,
                    2: `
                        <div class="visual-step">
                            <div class="visual-title">✂️ <span class="malay">Batalkan Faktor Sama</span><span class="english hidden">Cancel Common Factors</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">y<span class="cancel-line">(x - 2)</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">3<span class="cancel-line">(x - 2)</span></div>
                                </div>
                                <div class="operation-symbol">+</div>
                                <div class="fraction-display">
                                    <div class="numerator-display">(x-y)<span class="cancel-line">(x+y)</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">5y<span class="cancel-line">(x+y)</span></div>
                                </div>
                            </div>
                            <div class="arrow">⬇️</div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight-green">y</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-green">3</span></div>
                                </div>
                                <div class="operation-symbol">+</div>
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight-green">x - y</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-green">5y</span></div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">🎯 Hasil: Pecahan yang lebih mudah untuk ditambah!</span>
                                <span class="english hidden">🎯 Result: Simpler fractions ready to add!</span>
                            </div>
                        </div>
                    `,
                    3: `
                        <div class="visual-step">
                            <div class="visual-title">🔄 <span class="malay">Cari Penyebut Sepunya (PST = 15y)</span><span class="english hidden">Find Common Denominator (LCM = 15y)</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">y × <span class="highlight">5y</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">3 × <span class="highlight">5y</span></div>
                                </div>
                                <div class="operation-symbol">+</div>
                                <div class="fraction-display">
                                    <div class="numerator-display">(x-y) × <span class="highlight-blue">3</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">5y × <span class="highlight-blue">3</span></div>
                                </div>
                            </div>
                            <div class="arrow">⬇️</div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight-green">5y²</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-red">15y</span></div>
                                </div>
                                <div class="operation-symbol">+</div>
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight-green">3(x-y)</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-red">15y</span></div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">⚖️ Penyebut sama: Sekarang boleh tambah pengangka!</span>
                                <span class="english hidden">⚖️ Same denominator: Now we can add numerators!</span>
                            </div>
                        </div>
                    `,
                    4: `
                        <div class="visual-step">
                            <div class="visual-title">➕ <span class="malay">Tambahkan Pengangka</span><span class="english hidden">Add Numerators</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="highlight">5y²</span> + <span class="highlight-blue">3(x-y)</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">15y</div>
                                </div>
                            </div>
                            <div class="arrow">⬇️</div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="highlight">5y²</span> + <span class="highlight-blue">3x - 3y</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">15y</div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">📝 Kembangkan: 3(x-y) = 3x - 3y</span>
                                <span class="english hidden">📝 Expand: 3(x-y) = 3x - 3y</span>
                            </div>
                        </div>
                    `,
                    5: `
                        <div class="visual-step">
                            <div class="visual-title">🎉 <span class="malay">Jawapan Akhir</span><span class="english hidden">Final Answer</span></div>
                            <div class="step-visual">
                                <div class="fraction-display" style="border: 3px solid #48bb78; background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);">
                                    <div class="numerator-display">
                                        <span class="highlight-green">3x + 5y² - 3y</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="highlight-green">15y</span>
                                    </div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">✅ Selesai! Susun sebutan mengikut tertib abjad: 3x, 5y², -3y</span>
                                <span class="english hidden">✅ Done! Arrange terms alphabetically: 3x, 5y², -3y</span>
                            </div>
                        </div>
                    `
                },
                2: { // Question 2 visualizations
                    0: `
                        <div class="visual-step">
                            <div class="visual-title">🎯 <span class="malay">Soalan Pembahagian</span><span class="english hidden">Division Question</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight">4a² - b²</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-blue">c - d</span></div>
                                </div>
                                <div class="operation-symbol">÷</div>
                                <div class="fraction-display">
                                    <div class="numerator-display"><span class="highlight-green">6a - 3b</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-red">2c - 2d</span></div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">🔍 Ingat: Pembahagian pecahan = pendaraban dengan songsang</span>
                                <span class="english hidden">🔍 Remember: Division of fractions = multiplication by reciprocal</span>
                            </div>
                        </div>
                    `,
                    1: `
                        <div class="visual-step">
                            <div class="visual-title">🔄 <span class="malay">Tukar kepada Pendaraban</span><span class="english hidden">Change to Multiplication</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">4a² - b²</div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">c - d</div>
                                </div>
                                <div class="operation-symbol">×</div>
                                <div class="fraction-display" style="border: 3px solid #e53e3e;">
                                    <div class="numerator-display"><span class="highlight-red">2c - 2d</span></div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display"><span class="highlight-green">6a - 3b</span></div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">🔄 Songsang: Tukar tempat pengangka dan penyebut pecahan kedua</span>
                                <span class="english hidden">🔄 Reciprocal: Swap numerator and denominator of second fraction</span>
                            </div>
                        </div>
                    `,
                    2: `
                        <div class="visual-step">
                            <div class="visual-title">🔧 <span class="malay">Faktorkan Semua</span><span class="english hidden">Factor Everything</span></div>
                            <div class="step-visual">
                                <div style="text-align: center; margin: 20px 0;">
                                    <div><span class="highlight">4a² - b²</span> <div class="arrow">→</div> <span class="factor-box">(2a-b)(2a+b)</span></div>
                                    <div><span class="highlight-blue">c - d</span> <div class="arrow">→</div> <span class="factor-box">(c-d)</span></div>
                                    <div><span class="highlight-red">2c - 2d</span> <div class="arrow">→</div> <span class="factor-box">2(c-d)</span></div>
                                    <div><span class="highlight-green">6a - 3b</span> <div class="arrow">→</div> <span class="factor-box">3(2a-b)</span></div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">🎯 Perhatikan faktor sepunya: (2a-b) dan (c-d)</span>
                                <span class="english hidden">🎯 Notice common factors: (2a-b) and (c-d)</span>
                            </div>
                        </div>
                    `,
                    3: `
                        <div class="visual-step">
                            <div class="visual-title">📝 <span class="malay">Susun untuk Pembatalan</span><span class="english hidden">Arrange for Cancellation</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="cancel-line">(2a-b)</span>(2a+b) × 2<span class="cancel-line">(c-d)</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="cancel-line">(c-d)</span> × 3<span class="cancel-line">(2a-b)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">✂️ Batalkan: (2a-b) dan (c-d) muncul atas dan bawah</span>
                                <span class="english hidden">✂️ Cancel: (2a-b) and (c-d) appear top and bottom</span>
                            </div>
                        </div>
                    `,
                    4: `
                        <div class="visual-step">
                            <div class="visual-title">✂️ <span class="malay">Selepas Pembatalan</span><span class="english hidden">After Cancellation</span></div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="highlight-green">(2a+b) × 2</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="highlight-green">3</span>
                                    </div>
                                </div>
                            </div>
                            <div class="arrow">⬇️</div>
                            <div class="step-visual">
                                <div class="fraction-display">
                                    <div class="numerator-display">
                                        <span class="highlight-green">2(2a+b)</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="highlight-green">3</span>
                                    </div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">🧮 Tinggal: Darab 2 dengan (2a+b)</span>
                                <span class="english hidden">🧮 Remaining: Multiply 2 with (2a+b)</span>
                            </div>
                        </div>
                    `,
                    5: `
                        <div class="visual-step">
                            <div class="visual-title">🎉 <span class="malay">Jawapan Akhir</span><span class="english hidden">Final Answer</span></div>
                            <div class="step-visual">
                                <div class="fraction-display" style="border: 3px solid #48bb78; background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);">
                                    <div class="numerator-display">
                                        <span class="highlight-green">4a + 2b</span>
                                    </div>
                                    <div class="fraction-line-display"></div>
                                    <div class="denominator-display">
                                        <span class="highlight-green">3</span>
                                    </div>
                                </div>
                            </div>
                            <div class="key-point">
                                <span class="malay">✅ Selesai! 2(2a+b) = 4a + 2b</span>
                                <span class="english hidden">✅ Done! 2(2a+b) = 4a + 2b</span>
                            </div>
                        </div>
                    `
                }
            };

            return visualizations[questionNum] && visualizations[questionNum][stepNum] 
                ? visualizations[questionNum][stepNum] 
                : '<div class="visual-step"><div class="visual-title">🔄 <span class="malay">Visualisasi akan dipaparkan di sini</span><span class="english hidden">Visualization will appear here</span></div></div>';
        }

        function toggleLanguage(lang) {
            currentLanguage = lang;
            
            // Update button states
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Toggle visibility of language elements
            if (lang === 'ms') {
                document.querySelectorAll('.malay').forEach(el => el.classList.remove('hidden'));
                document.querySelectorAll('.english').forEach(el => el.classList.add('hidden'));
            } else {
                document.querySelectorAll('.malay').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('.english').forEach(el => el.classList.remove('hidden'));
            }
            
            updateSimulation();
            updateControls();
        }

        function toggleAutoPlay() {
            const autoPlayBtn = document.getElementById('autoPlayBtn');
            
            if (isAutoPlaying) {
                clearInterval(autoPlayInterval);
                isAutoPlaying = false;
                autoPlayBtn.innerHTML = `▶️ <span class="malay">Auto</span><span class="english hidden">Auto</span>`;
                autoPlayBtn.style.background = 'linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%)';
            } else {
                isAutoPlaying = true;
                autoPlayBtn.innerHTML = `⏸️ <span class="malay">Stop</span><span class="english hidden">Stop</span>`;
                autoPlayBtn.style.background = 'linear-gradient(135deg, #e53e3e 0%, #ff6b6b 100%)';
                
                autoPlayInterval = setInterval(() => {
                    if (currentStep < maxSteps) {
                        nextStep();
                    } else {
                        toggleAutoPlay(); // Stop when reaching the end
                    }
                }, 6000); // 6 seconds interval
            }
        }



        function nextStep() {
            if (currentStep < maxSteps) {
                currentStep++;
                updateSimulation();
                updateControls();
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                updateSimulation();
                updateControls();
            }
        }

        function resetSimulation() {
            currentStep = 0;
            updateSimulation();
            updateControls();
        }

        function updateControls() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === maxSteps;
            
            if (currentStep === maxSteps) {
                nextBtn.innerHTML = currentLanguage === 'ms' ? 
                    '🎉 <span class="malay">Selesai!</span><span class="english hidden">Done!</span>' : 
                    '🎉 <span class="malay hidden">Selesai!</span><span class="english">Done!</span>';
            } else {
                nextBtn.innerHTML = currentLanguage === 'ms' ? 
                    '<span class="malay">Seterusnya</span><span class="english hidden">Next</span> ➡️' : 
                    '<span class="malay hidden">Seterusnya</span><span class="english">Next</span> ➡️';
            }
        }

        function showPractice() {
            const practiceQuestions = {
                ms: [
                    "Cuba selesaikan: (2x + 4)/(x + 2) + (x - 1)/(x + 2)",
                    "Selesaikan: (a² - 4)/(a + 2) ÷ (a - 2)/(3a)",
                    "Permudahkan: (3y - 6)/(y² - 4) × (y + 2)/(y - 2)"
                ],
                en: [
                    "Try solving: (2x + 4)/(x + 2) + (x - 1)/(x + 2)",
                    "Solve: (a² - 4)/(a + 2) ÷ (a - 2)/(3a)",
                    "Simplify: (3y - 6)/(y² - 4) × (y + 2)/(y - 2)"
                ]
            };

            const randomQuestion = practiceQuestions[currentLanguage][Math.floor(Math.random() * 3)];
            
            alert(currentLanguage === 'ms' ? 
                `🎯 Soalan Latihan:\n\n${randomQuestion}\n\nCuba selesaikan sendiri menggunakan langkah-langkah yang telah dipelajari!` :
                `🎯 Practice Question:\n\n${randomQuestion}\n\nTry solving it yourself using the steps you've learned!`
            );
        }

        // Initialize simulation
        window.onload = function() {
            maxSteps = questions[currentQuestion].steps.length - 1;
            updateSimulation();
            updateControls();
        };
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9849d15ff67f1ec5',t:'MTc1ODc5NTkzMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
