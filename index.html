<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permainan Luas Permukaan Bentuk 3D | 3D Shape Surface Area Game</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 20px;
        }
        
        .language-toggle {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .lang-btn.active {
            background: #667eea;
            color: white;
        }
        
        .game-area {
            background: #f8f9ff;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 3px solid #e1e5ff;
        }
        
        .game-mode {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
            transform: scale(1.05);
        }
        
        .mode-btn:hover {
            transform: scale(1.02);
        }
        
        .challenge-area {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #e53e3e;
            margin-bottom: 20px;
        }
        
        .level-info {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            display: inline-block;
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .question-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            border: 3px solid #e1e5ff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .multiple-choice {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .choice-btn {
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .choice-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            transform: translateY(-2px);
        }
        
        .choice-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .choice-btn.correct {
            border-color: #48bb78;
            background: #48bb78;
            color: white;
        }
        
        .choice-btn.incorrect {
            border-color: #f56565;
            background: #f56565;
            color: white;
        }
        
        .streak-display {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }
        
        .streak-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: all 0.3s;
        }
        
        .streak-dot.active {
            background: #48bb78;
            transform: scale(1.2);
        }
        
        .question {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3748;
        }
        
        .dimensions {
            background: #e6fffa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #38b2ac;
        }
        
        .formula-hint {
            background: #f0fff4;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #48bb78;
            font-family: monospace;
            font-size: 1.1rem;
        }
        
        .input-area {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .answer-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: border-color 0.3s;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .submit-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }
        
        .feedback.correct {
            background: #f0fff4;
            color: #22543d;
            border: 2px solid #48bb78;
        }
        
        .feedback.incorrect {
            background: #fff5f5;
            color: #742a2a;
            border: 2px solid #f56565;
        }
        
        .score-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f7fafc;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        .score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2d3748;
        }
        
        .new-question-btn {
            padding: 10px 20px;
            background: #38b2ac;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .new-question-btn:hover {
            background: #319795;
            transform: translateY(-1px);
        }
        
        .instructions-panel {
            background: white;
            border-radius: 20px;
            padding: 0;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid #e1e5ff;
            overflow: hidden;
            max-height: 0;
            transition: all 0.5s ease;
            opacity: 0;
        }
        
        .instructions-panel.open {
            max-height: 90vh;
            opacity: 1;
            margin-bottom: 30px;
            overflow-y: auto;
        }
        
        .instructions-header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .instructions-header h3 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .close-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .instructions-content {
            padding: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .instruction-modes,
        .instruction-shapes,
        .instruction-scoring,
        .instruction-tips {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid #667eea;
        }
        
        .instructions-content h4 {
            margin: 0 0 15px 0;
            color: #2d3748;
            font-size: 1.2rem;
        }
        
        .instructions-content ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .instructions-content li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .control-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .instructions-btn {
            padding: 10px 20px;
            background: #764ba2;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .instructions-btn:hover {
            background: #6b46c1;
            transform: translateY(-1px);
        }
        
        .reset-btn {
            padding: 10px 20px;
            background: #e53e3e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .reset-btn:hover {
            background: #c53030;
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 15px;
                border-radius: 15px;
            }
            
            .title {
                font-size: 1.8rem;
                line-height: 1.2;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .language-toggle {
                flex-direction: column;
                gap: 8px;
            }
            
            .lang-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .game-mode {
                flex-direction: column;
                gap: 10px;
            }
            
            .mode-btn {
                padding: 15px 20px;
                font-size: 1rem;
            }
            
            .game-area {
                padding: 20px;
                border-radius: 15px;
            }
            
            .question-card {
                padding: 20px;
            }
            
            .question {
                font-size: 1.1rem;
            }
            
            .multiple-choice {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .choice-btn {
                padding: 18px 15px;
                font-size: 1rem;
                text-align: left;
            }
            
            .score-area {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .score {
                font-size: 1rem;
            }
            
            .control-buttons {
                flex-direction: column;
                gap: 10px;
                width: 100%;
            }
            
            .instructions-btn,
            .new-question-btn,
            .reset-btn {
                width: 100%;
                padding: 15px 20px;
                font-size: 1rem;
            }
            
            .instructions-panel.open {
                max-height: 85vh;
                position: fixed;
                top: 5vh;
                left: 10px;
                right: 10px;
                z-index: 1000;
                margin: 0;
                border-radius: 15px;
            }
            
            .instructions-content {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
                max-height: calc(85vh - 80px);
                overflow-y: auto;
            }
            
            .instructions-header {
                padding: 15px 20px;
                position: sticky;
                top: 0;
                z-index: 10;
            }
            
            .instructions-header h3 {
                font-size: 1.2rem;
            }
            
            .instruction-modes,
            .instruction-shapes,
            .instruction-scoring,
            .instruction-tips {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .instructions-content h4 {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }
            
            .instructions-content li {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }
            
            .level-info {
                padding: 12px 20px;
                font-size: 1rem;
            }
            
            .timer {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .title {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .game-area {
                padding: 15px;
            }
            
            .question-card {
                padding: 15px;
            }
            
            .choice-btn {
                padding: 15px 12px;
                font-size: 0.9rem;
            }
            
            .instructions-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title" data-ms="Permainan Luas Permukaan Bentuk 3D" data-en="3D Shape Surface Area Game">Permainan Luas Permukaan Bentuk 3D</h1>
            <p class="subtitle" data-ms="Tingkatan 2, Bab 6.2 - Matematik" data-en="Form 2, Chapter 6.2 - Mathematics">Tingkatan 2, Bab 6.2 - Matematik</p>
            
            <div class="language-toggle">
                <button class="lang-btn active" onclick="setLanguage('ms')">Bahasa Malaysia</button>
                <button class="lang-btn" onclick="setLanguage('en')">English</button>
            </div>
        </div>
        
        <div class="instructions-panel" id="instructions-panel">
            <div class="instructions-header">
                <h3 data-ms="üìö Cara Bermain" data-en="üìö How to Play">üìö Cara Bermain</h3>
                <button class="close-btn" onclick="toggleInstructions()">√ó</button>
            </div>
            <div class="instructions-content">
                <div class="instruction-modes">
                    <h4 data-ms="üéÆ Mod Permainan:" data-en="üéÆ Game Modes:">üéÆ Mod Permainan:</h4>
                    <ul>
                        <li><strong data-ms="Latihan" data-en="Practice">Latihan</strong>: <span data-ms="Berlatih tanpa had masa atau nyawa" data-en="Practice without time limit or lives">Berlatih tanpa had masa atau nyawa</span></li>
                        <li><strong data-ms="Cabaran" data-en="Challenge">Cabaran</strong>: <span data-ms="3 nyawa sahaja! Hati-hati dengan jawapan salah" data-en="Only 3 lives! Be careful with wrong answers">3 nyawa sahaja! Hati-hati dengan jawapan salah</span></li>
                        <li><strong data-ms="Laju" data-en="Speed">Laju</strong>: <span data-ms="30 saat untuk jawab sebanyak mungkin!" data-en="30 seconds to answer as many as possible!">30 saat untuk jawab sebanyak mungkin!</span></li>
                    </ul>
                </div>
                
                <div class="instruction-shapes">
                    <h4 data-ms="üìê Jenis Pepejal:" data-en="üìê Types of Solids:">üìê Jenis Pepejal:</h4>
                    <ul>
                        <li><strong data-ms="Kubus" data-en="Cube">Kubus</strong>: <span data-ms="Luas Permukaan = 6 √ó sisi¬≤" data-en="Surface Area = 6 √ó side¬≤">Luas Permukaan = 6 √ó sisi¬≤</span></li>
                        <li><strong data-ms="Kuboid" data-en="Cuboid">Kuboid</strong>: <span data-ms="Luas Permukaan = 2(pj + pl + jl)" data-en="Surface Area = 2(lw + lh + wh)">Luas Permukaan = 2(pj + pl + jl)</span></li>
                        <li><strong data-ms="Silinder" data-en="Cylinder">Silinder</strong>: <span data-ms="Luas Permukaan = 2œÄr¬≤ + 2œÄrh" data-en="Surface Area = 2œÄr¬≤ + 2œÄrh">Luas Permukaan = 2œÄr¬≤ + 2œÄrh</span></li>
                        <li><strong data-ms="Prisma Tegak" data-en="Right Prism">Prisma Tegak</strong>: <span data-ms="Luas Permukaan = 2 √ó Luas Tapak + Perimeter √ó Tinggi" data-en="Surface Area = 2 √ó Base Area + Perimeter √ó Height">Luas Permukaan = 2 √ó Luas Tapak + Perimeter √ó Tinggi</span></li>
                        <li><strong data-ms="Kon" data-en="Cone">Kon</strong>: <span data-ms="Luas Permukaan = œÄr¬≤ + œÄrl" data-en="Surface Area = œÄr¬≤ + œÄrl">Luas Permukaan = œÄr¬≤ + œÄrl</span></li>
                    </ul>
                </div>
                
                <div class="instruction-scoring">
                    <h4 data-ms="üèÜ Sistem Mata:" data-en="üèÜ Scoring System:">üèÜ Sistem Mata:</h4>
                    <ul>
                        <li data-ms="Jawapan betul = 10 √ó Level mata" data-en="Correct answer = 10 √ó Level points">Jawapan betul = 10 √ó Level mata</li>
                        <li data-ms="5 jawapan betul berturut-turut = Naik level!" data-en="5 correct answers in a row = Level up!">5 jawapan betul berturut-turut = Naik level!</li>
                        <li data-ms="Level tinggi = Soalan lebih mencabar" data-en="Higher level = More challenging questions">Level tinggi = Soalan lebih mencabar</li>
                    </ul>
                </div>
                
                <div class="instruction-tips">
                    <h4 data-ms="üí° Tips:" data-en="üí° Tips:">üí° Tips:</h4>
                    <ul>
                        <li data-ms="Baca formula dengan teliti" data-en="Read the formula carefully">Baca formula dengan teliti</li>
                        <li data-ms="Periksa dimensi yang diberi" data-en="Check the given dimensions">Periksa dimensi yang diberi</li>
                        <li data-ms="Untuk silinder, œÄ = 3.14" data-en="For cylinder, œÄ = 3.14">Untuk silinder, œÄ = 3.14</li>
                        <li data-ms="Jawab dengan tenang dan teliti" data-en="Answer calmly and carefully">Jawab dengan tenang dan teliti</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="score-area">
            <div class="score">
                <span data-ms="Skor: " data-en="Score: ">Skor: </span>
                <span id="score">0</span> | 
                <span data-ms="Level: " data-en="Level: ">Level: </span>
                <span id="level">1</span> |
                <span data-ms="Nyawa: " data-en="Lives: ">Nyawa: </span>
                <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
            </div>
            <div class="control-buttons">
                <button class="instructions-btn" onclick="toggleInstructions()">
                    <span data-ms="üìö Arahan" data-en="üìö Instructions">üìö Arahan</span>
                </button>
                <button class="new-question-btn" onclick="startGame()">
                    <span data-ms="Mula Permainan" data-en="Start Game">Mula Permainan</span>
                </button>
                <button class="reset-btn" onclick="resetToMenu()">
                    <span data-ms="üîÑ Reset" data-en="üîÑ Reset">üîÑ Reset</span>
                </button>
            </div>
        </div>
        
        <div class="game-mode">
            <button class="mode-btn active" onclick="setGameMode('practice')" data-ms="Latihan" data-en="Practice">Latihan</button>
            <button class="mode-btn" onclick="setGameMode('challenge')" data-ms="Cabaran" data-en="Challenge">Cabaran</button>
            <button class="mode-btn" onclick="setGameMode('speed')" data-ms="Laju" data-en="Speed">Laju</button>
        </div>
        
        <div class="game-area">
            <div class="challenge-area" id="challenge-info" style="display: none;">
                <div class="timer" id="timer">30</div>
                <div class="level-info">
                    <span data-ms="Level " data-en="Level ">Level </span><span id="current-level">1</span>
                </div>
            </div>
            
            <div class="streak-display" id="streak-display" style="display: none;">
                <div class="streak-dot"></div>
                <div class="streak-dot"></div>
                <div class="streak-dot"></div>
                <div class="streak-dot"></div>
                <div class="streak-dot"></div>
            </div>
            
            <div class="question-card">
                <div class="question" id="question-text">
                    <span data-ms="Tekan 'Mula Permainan' untuk bermula!" data-en="Click 'Start Game' to begin!">Tekan 'Mula Permainan' untuk bermula!</span>
                </div>
                
                <div class="dimensions" id="dimensions" style="display: none;">
                    Panjang sisi = 8 cm
                </div>
                
                <div class="formula-hint" id="formula" style="display: none;">
                    Formula: Luas Permukaan = 6 √ó sisi¬≤
                </div>
                
                <div class="multiple-choice" id="choices" style="display: none;">
                    <button class="choice-btn" onclick="selectChoice(0)">A) 384 cm¬≤</button>
                    <button class="choice-btn" onclick="selectChoice(1)">B) 192 cm¬≤</button>
                    <button class="choice-btn" onclick="selectChoice(2)">C) 256 cm¬≤</button>
                    <button class="choice-btn" onclick="selectChoice(3)">D) 144 cm¬≤</button>
                </div>
                
                <div id="feedback" class="feedback" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'ms';
        let gameMode = 'practice';
        let currentQuestion = {};
        let score = 0;
        let level = 1;
        let lives = 3;
        let streak = 0;
        let timer = 30;
        let timerInterval;
        let gameActive = false;
        let selectedChoice = -1;
        
        const shapes = {
            cube: {
                name: { ms: 'Kubus', en: 'Cube' },
                formula: { 
                    ms: 'Formula: Luas Permukaan = 6 √ó sisi¬≤', 
                    en: 'Formula: Surface Area = 6 √ó side¬≤' 
                },
                generate: (difficulty = 1) => {
                    const side = Math.floor(Math.random() * (5 + difficulty * 2)) + 3;
                    return {
                        dimensions: { side },
                        answer: 6 * side * side,
                        dimensionText: {
                            ms: `Panjang sisi = ${side} cm`,
                            en: `Side length = ${side} cm`
                        },
                        questionText: {
                            ms: 'Kira luas permukaan kubus ini.',
                            en: 'Calculate the surface area of this cube.'
                        }
                    };
                }
            },
            cuboid: {
                name: { ms: 'Kuboid', en: 'Cuboid' },
                formula: { 
                    ms: 'Formula: Luas Permukaan = 2(pj + pl + jl)', 
                    en: 'Formula: Surface Area = 2(lw + lh + wh)' 
                },
                generate: (difficulty = 1) => {
                    const length = Math.floor(Math.random() * (4 + difficulty * 2)) + 4;
                    const width = Math.floor(Math.random() * (3 + difficulty)) + 3;
                    const height = Math.floor(Math.random() * (4 + difficulty)) + 3;
                    return {
                        dimensions: { length, width, height },
                        answer: 2 * (length * width + length * height + width * height),
                        dimensionText: {
                            ms: `Panjang = ${length} cm, Lebar = ${width} cm, Tinggi = ${height} cm`,
                            en: `Length = ${length} cm, Width = ${width} cm, Height = ${height} cm`
                        },
                        questionText: {
                            ms: 'Kira luas permukaan kuboid ini.',
                            en: 'Calculate the surface area of this cuboid.'
                        }
                    };
                }
            },
            cylinder: {
                name: { ms: 'Silinder', en: 'Cylinder' },
                formula: { 
                    ms: 'Formula: Luas Permukaan = 2œÄr¬≤ + 2œÄrh', 
                    en: 'Formula: Surface Area = 2œÄr¬≤ + 2œÄrh' 
                },
                generate: (difficulty = 1) => {
                    const radius = Math.floor(Math.random() * (3 + difficulty)) + 2;
                    const height = Math.floor(Math.random() * (5 + difficulty * 2)) + 4;
                    const answer = Math.round(2 * 3.14 * radius * radius + 2 * 3.14 * radius * height);
                    return {
                        dimensions: { radius, height },
                        answer: answer,
                        dimensionText: {
                            ms: `Jejari = ${radius} cm, Tinggi = ${height} cm`,
                            en: `Radius = ${radius} cm, Height = ${height} cm`
                        },
                        questionText: {
                            ms: 'Kira luas permukaan silinder ini. (Gunakan œÄ = 3.14)',
                            en: 'Calculate the surface area of this cylinder. (Use œÄ = 3.14)'
                        }
                    };
                }
            },
            triangularPrism: {
                name: { ms: 'Prisma Segitiga', en: 'Triangular Prism' },
                formula: { 
                    ms: 'Formula: Luas Permukaan = 2 √ó Luas Tapak + Perimeter √ó Tinggi', 
                    en: 'Formula: Surface Area = 2 √ó Base Area + Perimeter √ó Height' 
                },
                generate: (difficulty = 1) => {
                    const base = Math.floor(Math.random() * (4 + difficulty)) + 4;
                    const height = Math.floor(Math.random() * (3 + difficulty)) + 3;
                    const prismHeight = Math.floor(Math.random() * (5 + difficulty * 2)) + 5;
                    
                    // Right triangle base area and perimeter
                    const baseArea = 0.5 * base * height;
                    const hypotenuse = Math.sqrt(base * base + height * height);
                    const perimeter = base + height + hypotenuse;
                    const answer = Math.round(2 * baseArea + perimeter * prismHeight);
                    
                    return {
                        dimensions: { base, height, prismHeight },
                        answer: answer,
                        dimensionText: {
                            ms: `Tapak segitiga: ${base} cm √ó ${height} cm, Tinggi prisma = ${prismHeight} cm`,
                            en: `Triangle base: ${base} cm √ó ${height} cm, Prism height = ${prismHeight} cm`
                        },
                        questionText: {
                            ms: 'Kira luas permukaan prisma segitiga tegak ini.',
                            en: 'Calculate the surface area of this right triangular prism.'
                        }
                    };
                }
            },
            cone: {
                name: { ms: 'Kon', en: 'Cone' },
                formula: { 
                    ms: 'Formula: Luas Permukaan = œÄr¬≤ + œÄrl', 
                    en: 'Formula: Surface Area = œÄr¬≤ + œÄrl' 
                },
                generate: (difficulty = 1) => {
                    const radius = Math.floor(Math.random() * (3 + difficulty)) + 3;
                    const height = Math.floor(Math.random() * (4 + difficulty * 2)) + 5;
                    const slantHeight = Math.sqrt(radius * radius + height * height);
                    const answer = Math.round(3.14 * radius * radius + 3.14 * radius * slantHeight);
                    
                    return {
                        dimensions: { radius, height, slantHeight: Math.round(slantHeight * 10) / 10 },
                        answer: answer,
                        dimensionText: {
                            ms: `Jejari = ${radius} cm, Tinggi = ${height} cm, Garis condong = ${Math.round(slantHeight * 10) / 10} cm`,
                            en: `Radius = ${radius} cm, Height = ${height} cm, Slant height = ${Math.round(slantHeight * 10) / 10} cm`
                        },
                        questionText: {
                            ms: 'Kira luas permukaan kon ini. (Gunakan œÄ = 3.14)',
                            en: 'Calculate the surface area of this cone. (Use œÄ = 3.14)'
                        }
                    };
                }
            }
        };
        
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('[data-ms]').forEach(element => {
                element.textContent = element.getAttribute(`data-${lang}`);
            });
            
            if (gameActive && currentQuestion.type) {
                updateQuestionDisplay();
            }
        }
        
        function setGameMode(mode) {
            gameMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            resetGame();
            
            if (mode === 'challenge' || mode === 'speed') {
                document.getElementById('challenge-info').style.display = 'block';
                document.getElementById('streak-display').style.display = 'flex';
            } else {
                document.getElementById('challenge-info').style.display = 'none';
                document.getElementById('streak-display').style.display = 'none';
            }
        }
        
        function startGame() {
            gameActive = true;
            resetGame();
            
            if (gameMode === 'speed') {
                startTimer();
            }
            
            generateQuestion();
        }
        
        function resetGame() {
            score = 0;
            level = 1;
            lives = 3;
            streak = 0;
            timer = gameMode === 'speed' ? 30 : 60;
            
            updateDisplay();
            clearInterval(timerInterval);
            
            document.getElementById('feedback').style.display = 'none';
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timer--;
                document.getElementById('timer').textContent = timer;
                
                if (timer <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        function generateQuestion() {
            if (!gameActive) return;
            
            const shapeTypes = Object.keys(shapes);
            const randomShape = shapeTypes[Math.floor(Math.random() * shapeTypes.length)];
            
            const difficulty = Math.floor(level / 3) + 1;
            currentQuestion = {
                type: randomShape,
                ...shapes[randomShape].generate(difficulty)
            };
            
            generateChoices();
            updateQuestionDisplay();
            selectedChoice = -1;
            
            document.getElementById('dimensions').style.display = 'block';
            document.getElementById('formula').style.display = 'block';
            document.getElementById('choices').style.display = 'grid';
            document.getElementById('feedback').style.display = 'none';
        }
        
        function generateChoices() {
            const correctAnswer = currentQuestion.answer;
            const choices = [correctAnswer];
            
            // Generate 3 wrong answers
            while (choices.length < 4) {
                let wrongAnswer;
                if (Math.random() < 0.5) {
                    // Common mistakes
                    wrongAnswer = Math.round(correctAnswer * (0.5 + Math.random() * 0.8));
                } else {
                    // Random nearby values
                    wrongAnswer = Math.round(correctAnswer + (Math.random() - 0.5) * correctAnswer * 0.6);
                }
                
                if (wrongAnswer > 0 && !choices.includes(wrongAnswer)) {
                    choices.push(wrongAnswer);
                }
            }
            
            // Shuffle choices
            for (let i = choices.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [choices[i], choices[j]] = [choices[j], choices[i]];
            }
            
            currentQuestion.choices = choices;
            currentQuestion.correctIndex = choices.indexOf(correctAnswer);
        }
        
        function updateQuestionDisplay() {
            document.getElementById('question-text').textContent = currentQuestion.questionText[currentLanguage];
            document.getElementById('dimensions').textContent = currentQuestion.dimensionText[currentLanguage];
            document.getElementById('formula').textContent = shapes[currentQuestion.type].formula[currentLanguage];
            
            const choiceButtons = document.querySelectorAll('.choice-btn');
            const letters = ['A', 'B', 'C', 'D'];
            
            choiceButtons.forEach((btn, index) => {
                btn.textContent = `${letters[index]}) ${currentQuestion.choices[index]} cm¬≤`;
                btn.className = 'choice-btn';
            });
        }
        
        function selectChoice(index) {
            if (selectedChoice !== -1) return; // Already answered
            
            selectedChoice = index;
            const choiceButtons = document.querySelectorAll('.choice-btn');
            const feedback = document.getElementById('feedback');
            
            choiceButtons[index].classList.add('selected');
            
            setTimeout(() => {
                const isCorrect = index === currentQuestion.correctIndex;
                
                choiceButtons.forEach((btn, i) => {
                    if (i === currentQuestion.correctIndex) {
                        btn.classList.add('correct');
                    } else if (i === index && !isCorrect) {
                        btn.classList.add('incorrect');
                    }
                });
                
                if (isCorrect) {
                    score += 10 * level;
                    streak++;
                    
                    if (streak >= 5) {
                        level++;
                        streak = 0;
                        feedback.className = 'feedback correct';
                        feedback.textContent = currentLanguage === 'ms' ? 
                            `Betul! Level naik ke ${level}! üéâ` : 
                            `Correct! Level up to ${level}! üéâ`;
                    } else {
                        feedback.className = 'feedback correct';
                        feedback.textContent = currentLanguage === 'ms' ? 
                            `Betul! +${10 * level} mata! üéâ` : 
                            `Correct! +${10 * level} points! üéâ`;
                    }
                } else {
                    lives--;
                    streak = 0;
                    
                    feedback.className = 'feedback incorrect';
                    feedback.textContent = currentLanguage === 'ms' ? 
                        `Salah! Jawapan betul: ${currentQuestion.answer} cm¬≤ üí™` : 
                        `Wrong! Correct answer: ${currentQuestion.answer} cm¬≤ üí™`;
                    
                    if (lives <= 0 && gameMode !== 'practice') {
                        endGame();
                        return;
                    }
                }
                
                feedback.style.display = 'block';
                updateDisplay();
                updateStreakDisplay();
                
                setTimeout(() => {
                    generateQuestion();
                }, 2000);
                
            }, 500);
        }
        
        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;
            document.getElementById('current-level').textContent = level;
            
            const heartsArray = ['üíî', '‚ù§Ô∏è', '‚ù§Ô∏è‚ù§Ô∏è', '‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è'];
            document.getElementById('lives').textContent = heartsArray[lives] || 'üíî';
        }
        
        function updateStreakDisplay() {
            const dots = document.querySelectorAll('.streak-dot');
            dots.forEach((dot, index) => {
                if (index < streak) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }
        
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback';
            feedback.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
            feedback.style.color = 'white';
            feedback.textContent = currentLanguage === 'ms' ? 
                `Permainan Tamat! Skor Akhir: ${score} mata, Level: ${level}` : 
                `Game Over! Final Score: ${score} points, Level: ${level}`;
            feedback.style.display = 'block';
            
            document.getElementById('choices').style.display = 'none';
        }
        
        function toggleInstructions() {
            const panel = document.getElementById('instructions-panel');
            panel.classList.toggle('open');
        }
        
        function resetToMenu() {
            // Stop any active game
            gameActive = false;
            clearInterval(timerInterval);
            
            // Reset all game variables
            score = 0;
            level = 1;
            lives = 3;
            streak = 0;
            timer = 30;
            selectedChoice = -1;
            
            // Reset game mode to practice
            gameMode = 'practice';
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.mode-btn[onclick="setGameMode(\'practice\')"]').classList.add('active');
            
            // Hide game elements
            document.getElementById('challenge-info').style.display = 'none';
            document.getElementById('streak-display').style.display = 'none';
            document.getElementById('dimensions').style.display = 'none';
            document.getElementById('formula').style.display = 'none';
            document.getElementById('choices').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            
            // Reset question text to initial state
            const questionText = document.getElementById('question-text');
            questionText.innerHTML = '<span data-ms="Tekan \'Mula Permainan\' untuk bermula!" data-en="Click \'Start Game\' to begin!">Tekan \'Mula Permainan\' untuk bermula!</span>';
            
            // Update language for the reset question text
            const span = questionText.querySelector('span');
            span.textContent = span.getAttribute(`data-${currentLanguage}`);
            
            // Update display
            updateDisplay();
            
            // Show confirmation message
            const feedback = document.getElementById('feedback');
            feedback.className = 'feedback';
            feedback.style.background = 'linear-gradient(45deg, #38b2ac, #4fd1c7)';
            feedback.style.color = 'white';
            feedback.textContent = currentLanguage === 'ms' ? 
                '‚úÖ Permainan telah di-reset! Pilih mod dan tekan "Mula Permainan"' : 
                '‚úÖ Game has been reset! Choose a mode and click "Start Game"';
            feedback.style.display = 'block';
            
            // Hide the confirmation message after 3 seconds
            setTimeout(() => {
                feedback.style.display = 'none';
            }, 3000);
        }
        
        // Initialize
        updateDisplay();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9859e8f74342f50a',t:'MTc1ODk2NDY2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
