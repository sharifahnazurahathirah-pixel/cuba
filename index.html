<!doctype html>
<html lang="ms">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Roda Impian: Sayangi Anggota Keluarga</title>
<style>
  :root{
    --bg:#f1f5f9; --card:#fff; --muted:#6b7280;
    --accent:#06b6d4; --accent2:#34d399; --danger:#fb7185;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,#f8fafc,#eef2ff);color:#0f172a}
  .wrap{max-width:980px;margin:24px auto;padding:16px}
  header{display:flex;flex-direction:column;gap:6px;align-items:center;text-align:center}
  h1{margin:0;font-size:1.4rem}
  p.lead{margin:0;color:var(--muted);font-size:.95rem}

  .game{
    display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px;
  }
  @media(max-width:880px){ .game{grid-template-columns:1fr;}}
  /* wheel area */
  .wheelWrap{
    background:var(--card);border-radius:14px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.08);
    display:flex;flex-direction:column;align-items:center;gap:12px;
  }
  .wheelCanvas{width:100%;max-width:520px}
  .spinBtn{
    background:linear-gradient(90deg,var(--accent),#3b82f6);color:#fff;border:none;padding:10px 16px;border-radius:10px;font-weight:700;cursor:pointer;
    box-shadow:0 8px 18px rgba(3,7,18,0.12);
  }
  .spinBtn:disabled{opacity:.5;cursor:not-allowed}
  .infoRow{display:flex;gap:8px;align-items:center;font-size:.95rem;color:var(--muted)}
  .score{font-weight:800;color:#0b1220}

  /* panel kanan */
  .panel{
    background:var(--card);border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(2,6,23,0.06);
    display:flex;flex-direction:column;gap:12px;
  }
  .panel h3{margin:0;font-size:1rem}
  .situasiBox{min-height:120px;display:flex;flex-direction:column;gap:8px;justify-content:center;padding:10px;border-radius:10px;border:1px dashed #e6edf3;background:linear-gradient(180deg,rgba(255,255,255,0.6),transparent)}
  .options{display:flex;flex-direction:column;gap:8px}
  .optBtn{
    border-radius:10px;padding:10px;text-align:left;border:1px solid #e6eef6;background:#fff;cursor:pointer;font-weight:600;
  }
  .optBtn.correct{background:linear-gradient(90deg,#bbf7d0,#86efac);border-color:#34d399}
  .optBtn.wrong{background:linear-gradient(90deg,#fee2e2,#fca5a5);border-color:#fb7185;color:#750000}
  .optBtn:disabled{opacity:.7;cursor:not-allowed}

  .feedback{min-height:40px;color:var(--muted);font-weight:600}
  .controlsRow{display:flex;gap:8px;justify-content:space-between;align-items:center}
  .small{font-size:.88rem;color:var(--muted)}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:.86rem}

  /* pointer */
  .pointer{
    position:relative;width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:22px solid #111827;border-radius:2px;
    margin-top:-6px;
    filter:drop-shadow(0 6px 10px rgba(2,6,23,0.12));
  }
</style>
</head>
<body>
<main class="wrap" role="main">
  <header>
    <h1>Roda Impian: Cara Menyayangi Anggota Keluarga</h1>
    <p class="lead">Klik 'Putar Roda' â†’ jawab tindakan yang betul untuk situasi keluarga. Sesuai untuk aktiviti kelas Pendidikan Moral.</p>
  </header>

  <section class="game" aria-label="Permainan Roda Impian">
    <div class="wheelWrap" aria-hidden="false">
      <canvas id="wheel" class="wheelCanvas" width="520" height="520"></canvas>
      <div class="pointer" aria-hidden="true"></div>
      <div style="display:flex;gap:10px;align-items:center;margin-top:8px;">
        <button id="spinBtn" class="spinBtn" aria-label="Putar roda">Putar Roda</button>
        <div class="infoRow"><span class="small">Skor:</span> <span class="score" id="score">0</span></div>
      </div>
      <div class="small" style="margin-top:6px">Petua: Gunakan kekunci ruang (space) untuk putar.</div>
    </div>

    <aside class="panel" aria-live="polite">
      <h3>Situasi & Pilihan</h3>
      <div class="situasiBox" id="situasiBox">Putarkan roda untuk melihat situasi.</div>

      <div class="options" id="options"></div>

      <div class="feedback" id="feedback"></div>

      <div class="controlsRow">
        <div class="small">Langkah: <span id="round">0</span>/<span id="totalRounds">6</span></div>
        <div style="display:flex;gap:8px">
          <button id="resetBtn" class="spinBtn" style="background:linear-gradient(90deg,#ef4444,#f97316);">Reset</button>
        </div>
      </div>
    </aside>
  </section>

  <footer>
    Guru boleh edit senarai situasi terus dalam kod JavaScript (bahagian DATA) untuk sesuaikan kelas.
  </footer>
</main>

<script>
/*
  Roda Impian (versi mudah)
  - 6 sektor (boleh ubah dataSteps array)
  - Selepas putaran, paparkan situasi dan pilihan
  - Murid memilih; markah +1 untuk jawapan betul
*/

// DATA: senarai situasi (boleh edit/luaskan)
const dataSteps = [
  {
    label: 'Adik menangis kerana terjatuh',
    question: 'Apakah tindakan paling sesuai?',
    options: [
      { t: 'Menolong dan memberi perhatian', correct: true },
      { t: 'Ketawa dan pergi', correct: false },
      { t: 'Tinggalkan adik sendirian', correct: false }
    ]
  },
  {
    label: 'Ibu sibuk memasak dan perlukan bantuan',
    question: 'Apakah tindakan paling sesuai?',
    options: [
      { t: 'Tawarkan bantuan sekurang-kurangnya ambil piring', correct: true },
      { t: 'Tunggu sehingga ibu panggil sahaja', correct: false },
      { t: 'Tinggalkan dapur kerana bau masakan', correct: false }
    ]
  },
  {
    label: 'Ayah pulang letih dari kerja',
    question: 'Apakah yang boleh dibuat untuk tunjuk sayang?',
    options: [
      { t: 'Sambut dengan senyuman dan tanya khabar', correct: true },
      { t: 'Terus minta duit', correct: false },
      { t: 'Terapkan muzik kuat supaya ayah tidak rehat', correct: false }
    ]
  },
  {
    label: 'Kakak perlukan tunjuk ajar untuk ulangkaji',
    question: 'Apa tindakan yang sesuai?',
    options: [
      { t: 'Sediakan masa untuk membantu ulangkaji', correct: true },
      { t: 'Mengalihkan perhatian dengan main telefon', correct: false },
      { t: 'Mengejek kesusahan kakak', correct: false }
    ]
  },
  {
    label: 'Ahli keluarga ada pertelingkahan kecil',
    question: 'Bagaimanakah cara menunjukkan kasih sayang?',
    options: [
      { t: 'Bercakap elok dan cuba berdamai', correct: true },
      { t: 'Mengambil peluang memperbesar isu', correct: false },
      { t: 'Berdiam diri tanpa cuba selesaikan', correct: false }
    ]
  },
  {
    label: 'Rumah perlu dibersihkan sebagai tanggungjawab bersama',
    question: 'Tindakan paling wajar?',
    options: [
      { t: 'Ambil bahagian dan tolong kemas', correct: true },
      { t: 'Biarkan sahaja orang lain buat', correct: false },
      { t: 'Buat kerja separuh hati sahaja', correct: false }
    ]
  }
];

// Config
const totalRounds = dataSteps.length;

// Canvas & wheel
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const centerX = canvas.width/2;
const centerY = canvas.height/2;
const radius = Math.min(centerX, centerY) - 10;

let currentAngle = 0;
let spinTimeout = null;
let isSpinning = false;

// UI refs
const spinBtn = document.getElementById('spinBtn');
const scoreEl = document.getElementById('score');
const situasiBox = document.getElementById('situasiBox');
const optionsEl = document.getElementById('options');
const feedbackEl = document.getElementById('feedback');
const roundEl = document.getElementById('round');
const totalRoundsEl = document.getElementById('totalRounds');
const resetBtn = document.getElementById('resetBtn');

let score = 0;
let round = 0;
let lastIndex = -1;

totalRoundsEl.textContent = totalRounds;

// draw wheel sectors
function drawWheel(){
  const sectors = dataSteps.length;
  const arc = Math.PI * 2 / sectors;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  for(let i=0;i<sectors;i++){
    const start = currentAngle + i * arc;
    const end = start + arc;
    // color palette
    const colors = ['#06b6d4','#34d399','#f59e0b','#a78bfa','#fb7185','#60a5fa'];
    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.arc(centerX, centerY, radius, start, end, false);
    ctx.closePath();
    ctx.fillStyle = colors[i % colors.length];
    ctx.fill();

    // text
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(start + arc/2);
    ctx.textAlign = 'right';
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    ctx.font = 'bold 16px sans-serif';
    ctx.fillText(dataSteps[i].label, radius - 12, 6);
    ctx.restore();
  }

  // center circle
  ctx.beginPath();
  ctx.arc(centerX, centerY, 44, 0, Math.PI*2);
  ctx.fillStyle = '#111827';
  ctx.fill();
  ctx.fillStyle = '#fff';
  ctx.font = '700 14px sans-serif';
  ctx.textAlign = 'center';
  ctx.fillText('PUTAR', centerX, centerY+6);
}
drawWheel();

// spin logic
function spinWheel(){
  if(isSpinning) return;
  isSpinning = true;
  spinBtn.disabled = true;
  feedbackEl.textContent = '';
  optionsEl.innerHTML = '';
  situasiBox.textContent = '...' ;

  // random full rotations and target sector
  const sectors = dataSteps.length;
  const rndSector = Math.floor(Math.random() * sectors);
  // ensure not same as last to vary
  const targetSector = (rndSector === lastIndex) ? (rndSector + 1) % sectors : rndSector;
  lastIndex = targetSector;

  const arc = Math.PI * 2 / sectors;
  // compute random angle within target sector
  const randomOffset = (Math.random() * (arc - 0.1)) + 0.05; // avoid exact edge
  const targetAngle = (Math.PI * 6) + ( (sectors - targetSector) * arc ) - (arc/2) + randomOffset; // 3 full rotations + sector offset

  const duration = 3800 + Math.random()*900; // ms
  const start = performance.now();
  const from = currentAngle;
  const to = currentAngle + targetAngle;

  function animate(now){
    const elapsed = now - start;
    const t = Math.min(1, elapsed / duration);
    // easeOutCubic
    const ease = 1 - Math.pow(1 - t, 3);
    currentAngle = from + (to - from) * ease;
    drawWheel();
    // draw pointer highlight
    if(t < 1){
      spinTimeout = requestAnimationFrame(animate);
    } else {
      isSpinning = false;
      spinBtn.disabled = false;
      // determine landed sector
      const landed = Math.floor( ((currentAngle % (Math.PI*2)) / (Math.PI*2)) * sectors );
      // convert to index (reverse mapping due to text rotation)
      let index = (sectors - landed) % sectors;
      // safety
      index = (index + sectors) % sectors;
      showSituation(index);
    }
  }
  spinTimeout = requestAnimationFrame(animate);
}

// show situation and options
function showSituation(index){
  round++;
  roundEl.textContent = round;
  const data = dataSteps[index];
  situasiBox.innerHTML = `<strong>${escapeHtml(data.label)}</strong><div style="margin-top:6px;color:var(--muted)">${escapeHtml(data.question)}</div>`;
  optionsEl.innerHTML = '';
  feedbackEl.textContent = '';

  data.options.forEach((opt, i) => {
    const b = document.createElement('button');
    b.className = 'optBtn';
    b.textContent = opt.t;
    b.disabled = false;
    b.addEventListener('click', ()=> onChooseOption(b, opt.correct, data.options));
    optionsEl.appendChild(b);
  });

  if(round >= totalRounds){
    // final round: disable spin until reset to end game
    spinBtn.disabled = true;
  }
}

// option chosen
function onChooseOption(button, correct, allOptions){
  // disable all options
  Array.from(optionsEl.children).forEach(x => x.disabled = true);
  if(correct){
    button.classList.add('correct');
    feedbackEl.textContent = 'Betul! Tindakan ini menunjukkan kasih sayang.';
    score++;
    scoreEl.textContent = score;
  } else {
    button.classList.add('wrong');
    // highlight correct one
    const nodes = Array.from(optionsEl.children);
    nodes.forEach((n, idx) => {
      if(allOptions[idx].correct) n.classList.add('correct');
    });
    feedbackEl.textContent = 'Maaf, itu bukan tindakan terbaik. Cuba lagi!';
  }

  // if not final round, allow next spin after short delay
  if(round < totalRounds){
    spinBtn.disabled = false;
  } else {
    // game over
    setTimeout(()=> {
      feedbackEl.innerHTML += `<div style="margin-top:8px;font-weight:800">Permainan tamat. Skor anda: ${score}/${totalRounds}</div>`;
      spinBtn.disabled = true;
    }, 400);
  }
}

// helpers & events
spinBtn.addEventListener('click', ()=> {
  // start only if rounds remaining
  if(round >= totalRounds) return;
  spinWheel();
});
document.addEventListener('keydown', (e)=> { if(e.code === 'Space'){ e.preventDefault(); spinBtn.click(); } });

resetBtn.addEventListener('click', ()=> {
  // reset game state
  score = 0; round = 0; lastIndex = -1;
  scoreEl.textContent = score;
  roundEl.textContent = round;
  situasiBox.textContent = 'Putarkan roda untuk melihat situasi.';
  optionsEl.innerHTML = '';
  feedbackEl.textContent = '';
  spinBtn.disabled = false;
});

// small helpers
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

// draw initially
drawWheel();
</script>
</body>
</html>
