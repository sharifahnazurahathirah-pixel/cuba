<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Sifat Bulatan - Circle Properties Game</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 10px;
            background: linear-gradient(135deg, #ff9a56 0%, #ffad56 50%, #ffc658 100%);
            min-height: 100vh;
            color: #ffffff;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 10px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 87, 87, 0.9);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .language-toggle {
            margin: 15px 0;
        }

        .lang-btn {
            background: rgba(255, 107, 107, 0.3);
            border: 2px solid rgba(255, 107, 107, 0.5);
            border-radius: 25px;
            padding: 8px 20px;
            color: #ffffff;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .lang-btn.active {
            background: #ff5757;
            border-color: #ff5757;
            color: white;
        }

        .lang-btn:hover {
            background: rgba(255, 107, 107, 0.5);
        }

        .game-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .mode-card {
            background: rgba(255, 87, 87, 0.7);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 87, 87, 0.9);
            border-color: rgba(255, 107, 107, 0.8);
        }

        .mode-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .mode-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .mode-desc {
            font-size: 0.9rem;
            opacity: 0.8;
            line-height: 1.4;
        }

        .game-area {
            background: rgba(255, 87, 87, 0.7);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
            display: none;
        }

        .game-area.active {
            display: block;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: rgba(255, 107, 107, 0.4);
            padding: 10px 15px;
            border-radius: 10px;
            font-weight: bold;
            border: 1px solid rgba(255, 107, 107, 0.6);
        }

        .question-area {
            background: rgba(255, 193, 7, 0.2);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .question-text {
            font-size: clamp(1.1rem, 3vw, 1.4rem);
            font-weight: 600;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .circle-visual {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .visual-circle {
            border: 4px solid #e74c3c;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(231, 76, 60, 0.1);
            color: #ecf0f1;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .answer-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 107, 107, 0.5);
            border-radius: 15px;
            padding: 15px 10px;
            color: #2e7d32;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        }

        .answer-btn:hover {
            background: rgba(255, 107, 107, 0.2);
            border-color: #ff5757;
            transform: translateY(-2px);
            color: #1b5e20;
        }

        .answer-btn.correct {
            background: rgba(39, 174, 96, 0.6);
            border-color: #27ae60;
            color: white;
        }

        .answer-btn.wrong {
            background: rgba(231, 76, 60, 0.6);
            border-color: #e74c3c;
            color: white;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-weight: 600;
            text-align: center;
        }

        .feedback.correct {
            background: rgba(39, 174, 96, 0.3);
            border: 2px solid #27ae60;
            color: #ecf0f1;
        }

        .feedback.wrong {
            background: rgba(231, 76, 60, 0.3);
            border: 2px solid #e74c3c;
            color: #ecf0f1;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff5757, #ff4757);
            transition: width 0.3s ease;
        }

        .btn {
            background: linear-gradient(45deg, #ff5757, #ff4757);
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            text-align: center;
            padding: 30px;
        }

        .results h2 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 20px;
        }

        .score-display {
            font-size: clamp(2rem, 6vw, 3rem);
            font-weight: bold;
            color: #ffe66d;
            margin: 20px 0;
        }

        .formula-hint {
            background: rgba(255, 193, 7, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
            border-left: 4px solid #ffc107;
            color: #ffffff;
        }

        @media (max-width: 768px) {
            .game-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .stats {
                justify-content: center;
            }
            
            .circle-visual {
                width: 150px;
                height: 150px;
            }
            
            .answer-options {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .answer-options {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 0 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="mainTitle">📚 Praktis: Bulatan</h1>
            <p id="subtitle">Matematik Tingkatan 2 - Bab 5: Bulatan</p>
            
            <div class="language-toggle">
                <button class="lang-btn active" onclick="setLanguage('ms')">Bahasa Melayu</button>
                <button class="lang-btn" onclick="setLanguage('en')">English</button>
            </div>
        </div>

        <div id="modeSelection">
            <div class="game-modes">
                <div class="mode-card" onclick="startGame('learn')">
                    <div class="mode-icon">📚</div>
                    <div class="mode-title" id="learnTitle">Mod Pembelajaran</div>
                    <div class="mode-desc" id="learnDesc">Belajar formula dan konsep asas bulatan dengan panduan langkah demi langkah</div>
                </div>
                
                <div class="mode-card" onclick="startGame('challenge')">
                    <div class="mode-icon">⚡</div>
                    <div class="mode-title" id="challengeTitle">Mod Cabaran</div>
                    <div class="mode-desc" id="challengeDesc">Uji kemahiran dengan soalan yang semakin sukar dan had masa</div>
                </div>
                
                <div class="mode-card" onclick="startGame('practice')">
                    <div class="mode-icon">🎮</div>
                    <div class="mode-title" id="practiceTitle">Mod Latihan</div>
                    <div class="mode-desc" id="practiceDesc">Latihan tanpa tekanan dengan pelbagai jenis soalan</div>
                </div>
            </div>
        </div>

        <div id="gameArea" class="game-area">
            <div class="game-header">
                <button class="btn" onclick="backToMenu()" id="backBtn">← Kembali</button>
                <div class="stats">
                    <div class="stat-item">
                        <span id="scoreLabel">Skor:</span> <span id="currentScore">0</span>
                    </div>
                    <div class="stat-item">
                        <span id="questionLabel">Soalan:</span> <span id="questionNumber">1</span>/10
                    </div>
                    <div class="stat-item" id="timerStat" style="display: none;">
                        <span id="timeLabel">Masa:</span> <span id="timeLeft">30</span>s
                    </div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 10%"></div>
            </div>

            <div class="question-area">
                <div class="question-text" id="questionText">Soalan akan muncul di sini...</div>
                
                <div class="circle-visual" id="circleVisual" style="display: none;">
                    <div class="visual-circle" id="visualCircle">
                        <span id="circleLabel"></span>
                    </div>
                </div>

                <div class="formula-hint" id="formulaHint" style="display: none;">
                    <strong id="hintLabel">Petua:</strong> <span id="hintText"></span>
                </div>

                <div class="answer-options" id="answerOptions"></div>
                
                <div class="feedback" id="feedback" style="display: none;"></div>
                

            </div>
        </div>

        <div id="resultsArea" class="game-area">
            <div class="results">
                <h2 id="resultsTitle">Keputusan Permainan</h2>
                <div class="score-display" id="finalScore">0/10</div>
                <div id="resultsMessage"></div>
                <div id="resultsStats"></div>
                <button class="btn" onclick="backToMenu()" id="playAgainBtn">Main Lagi</button>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = 'ms';
        let gameMode = '';
        let currentQuestion = 0;
        let score = 0;
        let questions = [];
        let timeLeft = 30;
        let timer = null;
        let answered = false;

        const translations = {
            ms: {
                mainTitle: "📚 Praktis: Bulatan",
                subtitle: "Matematik Tingkatan 2 - Bab 5: Bulatan",
                learnTitle: "Mod Pembelajaran",
                learnDesc: "Belajar formula dan konsep asas bulatan dengan panduan langkah demi langkah",
                challengeTitle: "Mod Cabaran", 
                challengeDesc: "Uji kemahiran dengan soalan yang semakin sukar dan had masa",
                practiceTitle: "Mod Latihan",
                practiceDesc: "Latihan tanpa tekanan dengan pelbagai jenis soalan",
                backBtn: "← Kembali",
                scoreLabel: "Skor:",
                questionLabel: "Soalan:",
                timeLabel: "Masa:",
                nextBtnText: "Soalan Seterusnya",
                resultsTitle: "Keputusan Permainan",
                playAgainBtn: "Main Lagi",
                hintLabel: "Petua:",
                correctFeedback: "Betul! Jawapan yang tepat!",
                wrongFeedback: "Salah. Jawapan yang betul ialah:",
                excellentMsg: "🎉 Cemerlang! Anda menguasai sifat bulatan!",
                goodMsg: "👍 Bagus! Teruskan usaha!",
                tryAgainMsg: "💪 Jangan berputus asa! Cuba lagi!",
                timeUpMsg: "⏰ Masa tamat!",
                formulas: {
                    diameter: "Formula: d = 2r (diameter = 2 × jejari)",
                    radius: "Formula: r = d ÷ 2 (jejari = diameter ÷ 2)", 
                    circumference: "Formula: Lilitan = 2πr atau πd (π = 22/7)",
                    area: "Formula: Luas = πr² (π = 22/7)"
                }
            },
            en: {
                mainTitle: "📚 Practice: Circles",
                subtitle: "Form 2 Mathematics - Chapter 5: Circles",
                learnTitle: "Learning Mode",
                learnDesc: "Learn formulas and basic circle concepts with step-by-step guidance",
                challengeTitle: "Challenge Mode",
                challengeDesc: "Test your skills with increasingly difficult questions and time limits",
                practiceTitle: "Practice Mode", 
                practiceDesc: "Practice without pressure with various types of questions",
                backBtn: "← Back",
                scoreLabel: "Score:",
                questionLabel: "Question:",
                timeLabel: "Time:",
                nextBtnText: "Next Question",
                resultsTitle: "Game Results",
                playAgainBtn: "Play Again",
                hintLabel: "Hint:",
                correctFeedback: "Correct! Well done!",
                wrongFeedback: "Wrong. The correct answer is:",
                excellentMsg: "🎉 Excellent! You've mastered circle properties!",
                goodMsg: "👍 Good job! Keep it up!",
                tryAgainMsg: "💪 Don't give up! Try again!",
                timeUpMsg: "⏰ Time's up!",
                formulas: {
                    diameter: "Formula: d = 2r (diameter = 2 × radius)",
                    radius: "Formula: r = d ÷ 2 (radius = diameter ÷ 2)",
                    circumference: "Formula: Circumference = 2πr or πd (π = 22/7)", 
                    area: "Formula: Area = πr² (π = 22/7)"
                }
            }
        };

        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update all text elements
            const t = translations[lang];
            document.getElementById('mainTitle').textContent = t.mainTitle;
            document.getElementById('subtitle').textContent = t.subtitle;
            document.getElementById('learnTitle').textContent = t.learnTitle;
            document.getElementById('learnDesc').textContent = t.learnDesc;
            document.getElementById('challengeTitle').textContent = t.challengeTitle;
            document.getElementById('challengeDesc').textContent = t.challengeDesc;
            document.getElementById('practiceTitle').textContent = t.practiceTitle;
            document.getElementById('practiceDesc').textContent = t.practiceDesc;
            document.getElementById('backBtn').textContent = t.backBtn;
            document.getElementById('scoreLabel').textContent = t.scoreLabel;
            document.getElementById('questionLabel').textContent = t.questionLabel;
            document.getElementById('timeLabel').textContent = t.timeLabel;
            document.getElementById('nextBtnText').textContent = t.nextBtnText;
            document.getElementById('resultsTitle').textContent = t.resultsTitle;
            document.getElementById('playAgainBtn').textContent = t.playAgainBtn;
            document.getElementById('hintLabel').textContent = t.hintLabel;
            
            // Update current question text if game is active
            if (questions.length > 0 && currentQuestion < questions.length) {
                const q = questions[currentQuestion];
                document.getElementById('questionText').textContent = currentLanguage === 'ms' ? q.textMs : q.textEn;
                
                // Update hint text if visible
                if (gameMode === 'learn') {
                    document.getElementById('hintText').textContent = currentLanguage === 'ms' ? q.hintMs : q.hintEn;
                }
                
                // Update feedback if visible
                const feedback = document.getElementById('feedback');
                if (feedback.style.display !== 'none' && answered) {
                    const explanation = currentLanguage === 'ms' ? q.explanationMs : q.explanationEn;
                    if (feedback.classList.contains('correct')) {
                        feedback.textContent = t.correctFeedback;
                    } else {
                        feedback.textContent = t.wrongFeedback + ' ' + explanation;
                    }
                }
            }
        }

        // Fixed question data for different modes
        const questionDataByMode = {
            learn: [
                // Learning mode: Easy numbers, basic concepts only (diameter & radius)
                { radius: 5, type: 'diameter' },
                { radius: 10, type: 'radius' },
                { radius: 3, type: 'diameter' },
                { radius: 8, type: 'radius' },
                { radius: 6, type: 'diameter' },
                { radius: 12, type: 'radius' },
                { radius: 4, type: 'diameter' },
                { radius: 14, type: 'radius' },
                { radius: 7, type: 'diameter' },
                { radius: 16, type: 'radius' }
            ],
            challenge: [
                // Challenge mode: All concepts with harder numbers
                { radius: 7, type: 'circumference' },
                { radius: 14, type: 'area' },
                { radius: 21, type: 'circumference' },
                { radius: 7, type: 'area' },
                { radius: 14, type: 'circumference' },
                { radius: 21, type: 'area' },
                { radius: 35, type: 'circumference' },
                { radius: 28, type: 'area' },
                { radius: 42, type: 'circumference' },
                { radius: 35, type: 'area' }
            ],
            practice: [
                // Practice mode: Mixed difficulty and all concepts
                { radius: 6, type: 'diameter' },
                { radius: 7, type: 'circumference' },
                { radius: 14, type: 'area' },
                { radius: 18, type: 'radius' },
                { radius: 21, type: 'circumference' },
                { radius: 7, type: 'area' },
                { radius: 9, type: 'diameter' },
                { radius: 14, type: 'circumference' },
                { radius: 21, type: 'area' },
                { radius: 24, type: 'radius' }
            ]
        };

        function generateQuestions(mode) {
            questions = [];
            const questionData = questionDataByMode[mode];
            
            for (let i = 0; i < 10; i++) {
                const r = questionData[i].radius;
                const d = r * 2;
                const type = questionData[i].type;
                
                let question = {};
                
                switch (type) {
                    case 'diameter':
                        question = {
                            textMs: `Jika jejari bulatan ialah ${r} cm, berapakah diameternya?`,
                            textEn: `If the radius of a circle is ${r} cm, what is its diameter?`,
                            visual: { type: 'radius', value: r },
                            correct: d,
                            options: [d, d + 2, d - 1, r].filter((v, i, arr) => arr.indexOf(v) === i && v > 0),
                            hintMs: "Formula: d = 2r (diameter = 2 × jejari)",
                            hintEn: "Formula: d = 2r (diameter = 2 × radius)",
                            explanationMs: `Diameter = 2 × jejari = 2 × ${r} = ${d} cm`,
                            explanationEn: `Diameter = 2 × radius = 2 × ${r} = ${d} cm`
                        };
                        // Ensure we have 4 unique options
                        while (question.options.length < 4) {
                            const newOption = d + Math.floor(Math.random() * 10) - 5;
                            if (newOption > 0 && !question.options.includes(newOption)) {
                                question.options.push(newOption);
                            }
                        }
                        break;
                    case 'radius':
                        question = {
                            textMs: `Jika diameter bulatan ialah ${d} cm, berapakah jejarinya?`,
                            textEn: `If the diameter of a circle is ${d} cm, what is its radius?`,
                            visual: { type: 'diameter', value: d },
                            correct: r,
                            options: [r, r + 1, r + 2, r - 1].filter((v, i, arr) => arr.indexOf(v) === i && v > 0),
                            hintMs: "Formula: r = d ÷ 2 (jejari = diameter ÷ 2)",
                            hintEn: "Formula: r = d ÷ 2 (radius = diameter ÷ 2)",
                            explanationMs: `Jejari = diameter ÷ 2 = ${d} ÷ 2 = ${r} cm`,
                            explanationEn: `Radius = diameter ÷ 2 = ${d} ÷ 2 = ${r} cm`
                        };
                        // Ensure we have 4 unique options
                        while (question.options.length < 4) {
                            const newOption = r + Math.floor(Math.random() * 8) - 4;
                            if (newOption > 0 && !question.options.includes(newOption)) {
                                question.options.push(newOption);
                            }
                        }
                        break;
                    case 'circumference':
                        const circumferenceValue = Math.round((44 * r) / 7 * 10) / 10;
                        question = {
                            textMs: `Jika jejari bulatan ialah ${r} cm, berapakah lilitannya? (π = 22/7)`,
                            textEn: `If the radius of a circle is ${r} cm, what is its circumference? (π = 22/7)`,
                            visual: { type: 'radius', value: r },
                            correct: circumferenceValue,
                            options: [
                                circumferenceValue,
                                Math.round((circumferenceValue + 10) * 10) / 10,
                                Math.round((circumferenceValue - 5) * 10) / 10,
                                Math.round((r * 6) * 10) / 10
                            ].filter((v, i, arr) => arr.indexOf(v) === i && v > 0),
                            hintMs: "Formula: Lilitan = 2πr atau πd (π = 22/7)",
                            hintEn: "Formula: Circumference = 2πr or πd (π = 22/7)",
                            explanationMs: `Lilitan = 2πr = 2 × (22/7) × ${r} = (44 × ${r})/7 = ${circumferenceValue} cm`,
                            explanationEn: `Circumference = 2πr = 2 × (22/7) × ${r} = (44 × ${r})/7 = ${circumferenceValue} cm`
                        };
                        // Ensure we have 4 unique options
                        while (question.options.length < 4) {
                            const newOption = Math.round((circumferenceValue + Math.random() * 20 - 10) * 10) / 10;
                            if (newOption > 0 && !question.options.includes(newOption)) {
                                question.options.push(newOption);
                            }
                        }
                        break;
                    case 'area':
                        const areaValue = Math.round((22 * r * r) / 7 * 10) / 10;
                        question = {
                            textMs: `Jika jejari bulatan ialah ${r} cm, berapakah luasnya? (π = 22/7)`,
                            textEn: `If the radius of a circle is ${r} cm, what is its area? (π = 22/7)`,
                            visual: { type: 'radius', value: r },
                            correct: areaValue,
                            options: [
                                areaValue,
                                Math.round((areaValue + 20) * 10) / 10,
                                Math.round((areaValue - 10) * 10) / 10,
                                Math.round((r * r * 3) * 10) / 10
                            ].filter((v, i, arr) => arr.indexOf(v) === i && v > 0),
                            hintMs: "Formula: Luas = πr² (π = 22/7)",
                            hintEn: "Formula: Area = πr² (π = 22/7)",
                            explanationMs: `Luas = πr² = (22/7) × ${r}² = (22 × ${r * r})/7 = ${areaValue} cm²`,
                            explanationEn: `Area = πr² = (22/7) × ${r}² = (22 × ${r * r})/7 = ${areaValue} cm²`
                        };
                        // Ensure we have 4 unique options
                        while (question.options.length < 4) {
                            const newOption = Math.round((areaValue + Math.random() * 40 - 20) * 10) / 10;
                            if (newOption > 0 && !question.options.includes(newOption)) {
                                question.options.push(newOption);
                            }
                        }
                        break;
                }
                
                questions.push(question);
            }
        }

        function startGame(mode) {
            // Clear any existing timer
            clearInterval(timer);
            
            // Reset all game variables
            gameMode = mode;
            currentQuestion = 0;
            score = 0;
            answered = false;
            timeLeft = 30;
            
            // Update score display
            document.getElementById('currentScore').textContent = '0';
            
            // Generate new questions
            generateQuestions(mode);
            
            // Show/hide appropriate screens
            document.getElementById('modeSelection').style.display = 'none';
            document.getElementById('gameArea').classList.add('active');
            document.getElementById('resultsArea').classList.remove('active');
            
            // Show timer for challenge mode
            if (mode === 'challenge') {
                document.getElementById('timerStat').style.display = 'block';
            } else {
                document.getElementById('timerStat').style.display = 'none';
            }
            
            showQuestion();
        }

        function showQuestion() {
            console.log(`Showing question ${currentQuestion + 1} of ${questions.length}`);
            
            if (currentQuestion >= questions.length) {
                console.log('All questions completed, showing results');
                showResults();
                return;
            }
            
            answered = false;
            const q = questions[currentQuestion];
            console.log('Current question:', q);
            
            // Update question number and progress
            document.getElementById('questionNumber').textContent = currentQuestion + 1;
            document.getElementById('progressFill').style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
            
            // Show question based on current language
            document.getElementById('questionText').textContent = currentLanguage === 'ms' ? q.textMs : q.textEn;
            
            // Show visual if needed
            if (q.visual) {
                const visual = document.getElementById('circleVisual');
                const circle = document.getElementById('visualCircle');
                const label = document.getElementById('circleLabel');
                
                visual.style.display = 'block';
                
                if (q.visual.type === 'radius') {
                    const size = Math.min(150, q.visual.value * 8);
                    circle.style.width = size + 'px';
                    circle.style.height = size + 'px';
                    label.textContent = `r = ${q.visual.value}cm`;
                    
                    // Add radius line
                    circle.innerHTML = `
                        <div style="position: absolute; width: 2px; height: ${size/2}px; background: #f39c12; top: 50%; left: 50%; transform-origin: top; transform: translateX(-50%);"></div>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #e74c3c; width: 6px; height: 6px; border-radius: 50%;"></div>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.8rem; color: #ecf0f1;">r = ${q.visual.value}cm</span>
                    `;
                } else if (q.visual.type === 'diameter') {
                    const size = Math.min(150, q.visual.value * 4);
                    circle.style.width = size + 'px';
                    circle.style.height = size + 'px';
                    
                    // Add diameter line
                    circle.innerHTML = `
                        <div style="position: absolute; width: ${size}px; height: 2px; background: #f39c12; top: 50%; left: 50%; transform: translate(-50%, -50%);"></div>
                        <div style="position: absolute; top: 50%; left: 0; transform: translateY(-50%); background: #e74c3c; width: 6px; height: 6px; border-radius: 50%;"></div>
                        <div style="position: absolute; top: 50%; right: 0; transform: translateY(-50%); background: #e74c3c; width: 6px; height: 6px; border-radius: 50%;"></div>
                        <span style="position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 0.8rem; color: #ecf0f1;">d = ${q.visual.value}cm</span>
                    `;
                }
            } else {
                document.getElementById('circleVisual').style.display = 'none';
            }
            
            // Show hint for learning mode
            if (gameMode === 'learn') {
                document.getElementById('formulaHint').style.display = 'block';
                document.getElementById('hintText').textContent = currentLanguage === 'ms' ? q.hintMs : q.hintEn;
            } else {
                document.getElementById('formulaHint').style.display = 'none';
            }
            
            // Show options - completely reset the options area
            const optionsContainer = document.getElementById('answerOptions');
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
            
            shuffledOptions.forEach(option => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = option;
                btn.style.pointerEvents = 'auto'; // Ensure buttons are clickable
                btn.onclick = () => selectAnswer(option, q);
                optionsContainer.appendChild(btn);
            });
            
            // Hide feedback and reset its state
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'none';
            feedback.className = 'feedback'; // Reset feedback class
            feedback.textContent = ''; // Clear feedback text
            
            // Start timer for challenge mode
            if (gameMode === 'challenge') {
                timeLeft = 30;
                updateTimer();
                timer = setInterval(() => {
                    timeLeft--;
                    updateTimer();
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        if (!answered) {
                            selectAnswer(null, q);
                        }
                    }
                }, 1000);
            }
        }

        function updateTimer() {
            document.getElementById('timeLeft').textContent = timeLeft;
        }

        function selectAnswer(selected, question) {
            console.log('selectAnswer called with:', selected, 'answered:', answered);
            if (answered) return;
            
            answered = true;
            clearInterval(timer);
            console.log('Answer selected, setting up auto-advance');
            
            const options = document.querySelectorAll('.answer-btn');
            const feedback = document.getElementById('feedback');
            const t = translations[currentLanguage];
            
            // Disable all buttons and mark correct/wrong answers
            options.forEach(btn => {
                btn.onclick = null;
                btn.style.pointerEvents = 'none';
                if (parseFloat(btn.textContent) === question.correct) {
                    btn.classList.add('correct');
                } else if (parseFloat(btn.textContent) === selected && selected !== question.correct) {
                    btn.classList.add('wrong');
                }
            });
            
            if (selected === question.correct) {
                score++;
                document.getElementById('currentScore').textContent = score;
                feedback.className = 'feedback correct';
                feedback.textContent = t.correctFeedback;
            } else {
                feedback.className = 'feedback wrong';
                const explanation = currentLanguage === 'ms' ? question.explanationMs : question.explanationEn;
                if (selected === null) {
                    feedback.textContent = t.timeUpMsg + ' ' + explanation;
                } else {
                    feedback.textContent = t.wrongFeedback + ' ' + explanation;
                }
            }
            
            feedback.style.display = 'block';
            
            // Auto advance to next question after 3 seconds
            setTimeout(() => {
                if (answered) { // Only advance if we're still in answered state
                    currentQuestion++;
                    showQuestion();
                }
            }, 3000);
        }

        function nextQuestion() {
            // This function is no longer needed as we use auto-advance
            currentQuestion++;
            showQuestion();
        }

        function showResults() {
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('resultsArea').classList.add('active');
            
            const percentage = (score / questions.length) * 100;
            const t = translations[currentLanguage];
            
            document.getElementById('finalScore').textContent = `${score}/${questions.length}`;
            
            let message = '';
            if (percentage >= 80) {
                message = t.excellentMsg;
            } else if (percentage >= 60) {
                message = t.goodMsg;
            } else {
                message = t.tryAgainMsg;
            }
            
            document.getElementById('resultsMessage').innerHTML = `
                <p style="font-size: 1.2rem; margin: 20px 0;">${message}</p>
                <p style="font-size: 1.1rem; opacity: 0.9;">${currentLanguage === 'ms' ? 'Peratusan' : 'Percentage'}: ${percentage.toFixed(1)}%</p>
            `;
        }

        function backToMenu() {
            // Clear any existing timer
            clearInterval(timer);
            
            // Reset all game variables to initial state
            gameMode = '';
            currentQuestion = 0;
            score = 0;
            answered = false;
            timeLeft = 30;
            questions = [];
            
            // Reset displays
            document.getElementById('currentScore').textContent = '0';
            document.getElementById('questionNumber').textContent = '1';
            document.getElementById('progressFill').style.width = '10%';
            
            // Clear question area
            document.getElementById('questionText').textContent = 'Soalan akan muncul di sini...';
            document.getElementById('answerOptions').innerHTML = '';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('circleVisual').style.display = 'none';
            document.getElementById('formulaHint').style.display = 'none';
            
            // Show menu, hide game areas
            document.getElementById('modeSelection').style.display = 'block';
            document.getElementById('gameArea').classList.remove('active');
            document.getElementById('resultsArea').classList.remove('active');
        }

        // Initialize
        setLanguage('ms');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9858c85691e4f509',t:'MTc1ODk1Mjg0Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
